{% extends '/layouts/app.twig' %} {% block content %}
<div class="pt-5 col-12 col-md-10 mx-auto">
	<div class="user-form d-flex flex-column align-items-center mb-4">
		<div class="bg-dark d-flex rounded-4 px-3 py-2 w-100 justify-content-between align-items-center mb-4">
			<div class="d-flex gap-3">
				<button
					type="button"
					data-bs-toggle="modal"
					data-bs-target="#pfpModal"
					class="border-0 bg-transparent p-0">
					{% if user.pfp %}
					<img
						src="/assets/uploads/{{ user.pfp }}"
						alt="Profile picture"
						class="profile-settings-img rounded-circle" />
					{% else %}
					<img
						src="/assets/icons/light/profile-user.png"
						alt="Profile Picture"
						class="profile-settings-img" />
					{% endif %}
				</button>
				<div class="d-flex flex-column justify-content-center">
					<p class="mb-0 fw-bold">{{ user.username }}</p>
					<p class="mb-0">{{ user.name }}</p>
				</div>
			</div>
			<button
				type="button"
				data-bs-toggle="modal"
				data-bs-target="#pfpModal"
				class="btn btn-primary h-50 fw-bold">
				Change photo
			</button>
		</div>

		<form action="/user/edit/{{ user.id }}" method="post" enctype="multipart/form-data">
			<div class="mb-3 d-flex flex-column">
				<label for="username" class="form-label fw-bold">Username</label>
				<input type="text" class="form-control bg-dark" name="username" id="username" placeholder="Username" />
			</div>
			<div class="mb-3">
				<label for="name" class="form-label fw-bold">Name</label>
				<input type="text" class="form-control bg-dark" name="name" id="name" placeholder="Name" />
			</div>
			<div class="mb-3">
				<label for="email" class="form-label fw-bold">Email</label>
				<input type="email" class="form-control bg-dark" name="email" id="email" placeholder="Email" />
			</div>
			<div class="mb-3">
				<label for="bio" class="form-label fw-bold">Bio</label>
				<textarea
					name="bio"
					class="form-control bg-dark"
					id="bio"
					placeholder="Bio"
					rows="2"
					cols="50"></textarea>
			</div>
			<button type="submit" class="btn btn-primary" name="submit">Save changes</button>
		</form>
	</div>

	<div class="modal fade" id="pfpModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<form action="/user/edit/{{ user.id }}" method="post" enctype="multipart/form-data">
					<div class="modal-header d-flex justify-content-center">
						<h1 class="modal-title fs-5" id="exampleModalLabel">Change Profile Photo</h1>
					</div>
					<div class="modal-body p-0 d-flex flex-column align-items-center">
						<div class="d-flex flex-column align-items-center w-100 border-bottom p-3">
							<label for="pfp" class="mb-2 fw-bold fs-5">Upload Photo</label>
							<input type="file" class="form-control" name="pfp" id="pfp" />
						</div>
						<div class="w-100 border-bottom p-3 d-flex justify-content-center">
							<button type="button" id="removePhotoButton" class="btn text-danger p-0 fw-bold fs-5">
								Remove Current Photo
							</button>
							<input type="hidden" name="remove_pfp" value="0" id="removePfpInput" />
						</div>
						<div class="w-100 p-3 d-flex justify-content-end gap-2">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="submit" class="btn btn-primary" name="submit">Save changes</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	{% if message %}
	<div class="alert alert-{{ error }} alert-dismissable d-flex justify-content-between" role="alert">
		<div>{{ message }}</div>
		<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
	</div>
	{% endif %}
</div>
{% endblock %} {% block script %}
<script>
	document.getElementById("removePhotoButton")?.addEventListener("click", function () {
		if (confirm("Are you sure you want to remove your current profile photo?")) {
			document.getElementById("removePfpInput").value = "1";
			this.closest("form").submit();
		}
	});
</script>
{% endblock %}
